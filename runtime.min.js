(function(){"use strict";const SERVER_ROOT="https://rintaroutw.github.io/fsg",FSG_NAMESPACE="https://rintaroutw.github.io/fsg",RUNTIME_DEFAULT_STYLE=String.raw`<style>
svg {
  user-select: none;
  -webkit-user-select: none;
}

svg .fsg-board {
  fill: #151c23;
}

svg .fsg-ui-select-box {
  stroke-width: 0.5;
  fill: none;
}

svg .menu {
  font: 0.9em Roboto, Helvetica, Sans-Serif, Times, serif, monospace;
}

svg .menu_title {
  fill: #aaa;
  font-family: Georgia, 'Times New Roman', Times, serif;
}

svg .menu_item {
  font-weight: 300;
  fill: #888;
}

svg .menu_item:hover {
  fill: #fff;
  cursor: pointer;
}

svg *[fsg_hidden] {
  visibility: hidden;
}

svg *[fsg_fill_none]{
  fill: none;
}

svg *[fsg_shape]:hover {
  stroke: #fff;
}

svg .dashed {
  stroke-dasharray: 3;
  stroke-width: 1.2;
}

svg .axis-x, svg .axis-y {
  stroke: #555; 
  stroke-width: 1.2;
}

svg .vector-marker-start, svg .vector-marker-end {
  fill: #999;
}

svg .point {
  fill: #2f2f2f;
  stroke: #ff0;
}

svg .pin-point {
  fill: #777777aa;
  stroke: #ff0;
}

svg .mid-point, svg .intersect-point {
  fill: #777777aa;
  stroke: #565656aa;
}

svg .point:hover, svg .pin-point:hover {
  cursor: grab;
}

svg .mid-point:hover, svg .intersect-point:hover {
  cursor: pointer;
}

svg g, svg div, svg foreignObject, svg span {
  position: relative;
}

svg span.base {
  position: relative !important;
}

svg .latex-container {
  width: max-content;
  height: max-content;
  position: fixed; /* important for Safari */
}

svg .latex,
svg .label {
  color: #999;
  fill: #999;
  font-family: 'KaTeX_Math', 'Times New Roman', Times, serif;
}
</style>`,RUNTIME_STYLE_LINK=String.raw`<link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" href="${SERVER_ROOT}/style/runtime.css"/>`,KATEX_STYLE_LINK=String.raw`<link xmlns="http://www.w3.org/1999/xhtml" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"/>`,SNAP_GRID_INTERVAL=5,DEFAULT_WINDOW_WIDTH=883,DEFAULT_WINDOW_HEIGHT=910,FSG_HOVER_ATTR="fsg_hover",FSG_DRAGGING_ATTR="fsg_dragging",FSG_SELECTED_ATTR="fsg_selected",FSG_INSPECTING_ATTR="fsg_inspecting",FSG_SHAPE_ATTR="fsg_shape",CLASS_FSG_UI_SELECT_BOX="fsg-ui-select-box",FSG_FILL_NONE_ATTR="fsg_fill_none",FSG_HIDDEN_ATTR="fsg_hidden",COMPONENT_NO_ATTR="component_no",COMPONENT_REFS_ATTR="component_refs",OF_ATTR="of",VECTOR_START_MARKER_RADIUS=3,VECTOR_END_MARKER_ARROW_WIDTH=6,VECTOR_END_MARKER_ARROW_LENGTH=10,DEFAULT_LENGTH_MARKER_DISTANCE=20,DEFAULT_LENGTH_MARKER_WIDTH=7,DEFAULT_ANGLE_RADIUS=15,POINT_RADIUS=6,DEFAULT_TEXT=String.raw`\LaTeX`,DEFAULT_LABEL_OFFSET_X=5,DEFAULT_LABEL_OFFSET_Y=5,DEFAULT_STROKE_COLOR="#888888aa",DEFAULT_TRANSPARENT_COLOR="#ffffff00";function snapTo(e){return{x:e.x-=e.x%SNAP_GRID_INTERVAL,y:e.y-=e.y%SNAP_GRID_INTERVAL}}function stdGetHeader(){return{method:"GET",headers:new Headers({"Content-Type":"text/plain"})}}function fetchSrc(e){return fetch(e,stdGetHeader()).then((e=>{if(e.ok)return e.text()}))}function init_component_system(e){e.fsg.component={};const t=e.find(`[${COMPONENT_NO_ATTR}]`);let n=0;t.forEach((e=>{const t=Number(e.attr(COMPONENT_NO_ATTR));t>n&&(n=t)})),e.fsg.component.max_component_no=n,e.fsg.component.all=[]}function componentByNo(e,t){return e.fsg.component.all.find((e=>e.component_no==Number(t)))}function labelOf(e,t){const n=e.find(".label");let r=null;return n.each((e=>{t==Number(e.attr(OF_ATTR))&&(r=e)})),r}class Component{constructor({draw:e,element:t}){this.draw=e,this.element=t,t.component=this;let n=t.attr(COMPONENT_NO_ATTR);void 0===n&&(e.fsg.component.max_component_no++,n=e.fsg.component.max_component_no,t.attr(COMPONENT_NO_ATTR,n)),this.component_no=Number(n);const r=t.attr("label");r&&this.addLabel(e,r),e.fsg.component.all.push(this)}watchUpdate(e,t){e.forEach((e=>{e.on("update",(e=>t(e)))}))}remove(){this.removeLabel(),this.element.fire("remove").remove(),this.draw.fsg.component.all=this.draw.fsg.component.all.filter((e=>e!==this))}center(){return{x:this.element.cx(),y:this.element.cy()}}forward(){this.element.forward(),this.element.next()?.hasClass("cover")&&this.element.forward()}backward(){this.element.prev()?.hasClass("cover")&&this.element.backward(),this.element.backward()}back(){this.draw.findOne("."+CLASS_FSG_UI_SELECT_BOX).after(this.element)}front(){this.element.front()}undo(){this.remove()}getAttributes(){return["id","class","cx","cy","text","fill","stroke"]}getAttribute(e){return"text"==e?this.getText():this.element.attr(e)}setAttribute(e,t){if("text"==e)return e="label",this.element.attr(e,t),void this.setText(t);this.element.attr(e,t)}setText(e){e&&0!=e.length?this.label?this.label.text(e):this.addLabel(e):this.removeLabel()}getText(){return this.label?this.label.text():""}addLabel(e){const t=this.draw,n=this.element;let r=labelOf(t,this.component_no);if(!r){const o=this.center(),s={x:o.x+DEFAULT_LABEL_OFFSET_X,y:-o.y+DEFAULT_LABEL_OFFSET_Y};r=t.text(e).attr("class","label").attr("offset_x",DEFAULT_LABEL_OFFSET_X).attr("offset_y",DEFAULT_LABEL_OFFSET_Y).attr(OF_ATTR,n.attr(COMPONENT_NO_ATTR)).flip("y").move(s.x,s.y),t.add(r)}r.on("mousedown",(e=>{r.lastEvent="mousedown",r.fire("dragstart",{dragTarget:r}),e.stopPropagation()})).on("mouseup",(()=>{r.lastEvent="mouseup",r.fire("dragend")})).on("mousemove",(()=>{r.lastEvent="mousemove"})).on("dragstart",(()=>{t.dragTarget=r})).on("dragend",(()=>{t.dragTarget=null;const e=this.center(),n={dx:r.x()-e.x,dy:r.y()+e.y};r.attr("offset_x",n.dx).attr("offset_y",n.dy)})),this.watchUpdate([n],(()=>{const e=r.attr("offset_x"),t=r.attr("offset_y"),n=this.center(),o={x:n.x+e,y:-n.y+t};r.move(o.x,o.y)}));const o=new MutationObserver((e=>{e.forEach((e=>{if("label"==e.attributeName){let e=n.node.getAttribute("label");e||(e="");const t=r.attr("offset_x"),o=r.attr("offset_y"),s=this.center(),i={x:s.x+t,y:-s.y+o};r.text(e).move(i.x,i.y)}}))}));o.observe(n.node,{attributes:!0}),this.observer=o,this.label=r}removeLabel(){this.label&&(this.observer.disconnect(),this.observer=null,this.label.remove(),this.label=null)}}class SelectableComponent extends Component{constructor({draw:e,element:t,override:n}){super({draw:e,element:t}),n||(t.on("mouseenter",(()=>{e.dragTarget||e.dragSelectStart||t.attr(FSG_HOVER_ATTR,!0)})).on("mouseleave",(()=>{t.attr(FSG_HOVER_ATTR,null)})),t.on("mousedown",(e=>{t.lastEvent="mousedown",e.stopPropagation()})).on("mouseup",(()=>{"mousedown"==t.lastEvent&&this.toggleSelected(),t.lastEvent="mouseup"}))),selectComponent(this.draw,this)}remove(){unselectComponent(this.draw,this),super.remove()}toggleSelected(){this.isSelected()?unselectComponent(this.draw,this):selectComponent(this.draw,this)}isSelected(){return this.element.attr(FSG_SELECTED_ATTR)}select(){this.element.attr(FSG_SELECTED_ATTR,!0)}unselect(){this.element.attr(FSG_SELECTED_ATTR,null).attr(FSG_HOVER_ATTR,null)}}function init_module_marker(e){deinit_module_marker(e),e.fsg.marker={};let t=e.parent().defs().findOne(".vector-start-marker");t||(t=e.parent().marker(2*VECTOR_START_MARKER_RADIUS,2*VECTOR_START_MARKER_RADIUS,(e=>{const t=VECTOR_START_MARKER_RADIUS;e.circle(t).radius(t).cx(t).cy(t).attr("class","vector-marker-start")})),t.attr("class","vector-start-marker")),e.fsg.marker.vector_start_marker=t;let n=e.parent().defs().findOne(".vector-end-marker");n||(n=e.parent().marker(VECTOR_END_MARKER_ARROW_LENGTH,VECTOR_END_MARKER_ARROW_WIDTH,(e=>{const t=String.raw`0 0, ${VECTOR_END_MARKER_ARROW_LENGTH} ${VECTOR_END_MARKER_ARROW_WIDTH/2}, 0 ${VECTOR_END_MARKER_ARROW_WIDTH}`;e.polygon(t).stroke({width:1}).attr("class","vector-marker-end")})),n.size(VECTOR_END_MARKER_ARROW_LENGTH,VECTOR_END_MARKER_ARROW_WIDTH),n.ref(VECTOR_END_MARKER_ARROW_LENGTH,VECTOR_END_MARKER_ARROW_WIDTH/2),n.attr("class","vector-end-marker")),e.fsg.marker.vector_end_marker=n}function deinit_module_marker(e){e.fsg.marker?.vector_start_marker&&(e.fsg.marker.vector_start_marker.remove(),e.fsg.marker.vector_start_marker=null),e.fsg.marker?.vector_end_marker&&(e.fsg.marker.vector_end_marker.remove(),e.fsg.marker.vector_end_marker=null)}const tolerance_error=1e-4;function inside(e,t){return t&&t.x>=e.x-tolerance_error&&t.x<=e.x+e.width+tolerance_error&&t.y>=e.y-tolerance_error&&t.y<=e.y+e.height+tolerance_error}function pointOnScreen(e){const t=e.element,n=t.cx(),r=t.cy(),o=t.transform();return{x:n*o.a+r*o.c+o.e,y:n*o.b+r*o.d+o.f}}function clipping(e,t,n){const r={x:n.x-t.x,y:n.y-t.y},{x:o,y:s,width:i,height:a}=e;let c=[],l={x:1,y:0},d=intersect(t,r,n={x:o,y:s},l);return inside(e,d)&&c.push(d),l={x:0,y:1},d&&d.x==o||(d=intersect(t,r,n,l),inside(e,d)&&c.push(d)),d=intersect(t,r,n={x:o+i,y:s+a},l),inside(e,d)&&c.push(d),l={x:1,y:0},d&&d.y==s+i||(d=intersect(t,r,n,l),inside(e,d)&&c.push(d)),c}function intersect(e,t,n,r){let o=t.x*r.y-r.x*t.y;if(0==o||isNaN(o))return null;let s=((n.x-e.x)*r.y-(n.y-e.y)*r.x)/o;return{x:e.x+s*t.x,y:e.y+s*t.y}}function projectPointOnLine(e,t,n){const r=e.x-t.x,o=e.y-t.y,s=r*n.x+o*n.y;return{x:t.x+n.x*s,y:t.y+n.y*s}}function intersectLineAndCircle(e,t,n,r){const o=projectPointOnLine(n,e,t),s=(n.x-o.x)**2+(n.y-o.y)**2;if(s>r**2)return null;if(s==r**2)return[o];const i=Math.sqrt(r**2-s);return[{x:o.x+t.x*i,y:o.y+t.y*i},{x:o.x-t.x*i,y:o.y-t.y*i}]}function twoCirclesIntersection(e,t){var n,r,o,s,i,a,c=Math.sqrt((e.a-t.a)**2+(e.b-t.b)**2);if(e.r+t.r>=c&&c>=Math.abs(e.r-t.r)){var l=c+e.r+t.r,d=c+e.r-t.r,m=c-e.r+t.r,p=-c+e.r+t.r,u=Math.sqrt(l*d*m*p)/4;if(o=(n=(e.a+t.a)/2+(t.a-e.a)*(e.r*e.r-t.r*t.r)/(2*c*c))+(r=2*(e.b-t.b)*u/(c*c)),s=n-r,i=(n=(e.b+t.b)/2+(t.b-e.b)*(e.r*e.r-t.r*t.r)/(2*c*c))-(r=2*(e.a-t.a)*u/(c*c)),a=n+r,Math.abs((o-e.a)*(o-e.a)+(i-e.b)*(i-e.b)-e.r*e.r)>1e-7){var h=i;i=a,a=h}return[{x:o,y:i},{x:s,y:a}]}return null}function findBottom(e,t){let n=t[0];return t.forEach((t=>{const r=e.index(t);-1!=r&&r<e.index(n)&&(n=t)})),n}function putBehindPoints(e,t,n,r){if(!n)return;const o=findBottom(e,t);e.index(o)>0&&(n.insertBefore(o),r.insertBefore(n))}class Shape extends SelectableComponent{constructor({draw:e,element:t,cover:n,points:r}){if(super({draw:e,element:t}),r){const e=r.map((e=>e.attr(COMPONENT_NO_ATTR)));t.attr(COMPONENT_REFS_ATTR,e.join(",")),this.points=r}n?.attr(OF_ATTR,this.component_no).attr("fill",DEFAULT_TRANSPARENT_COLOR),this.cover=n,n?.on("mousedown",(e=>{this.toggleSelected(),e.stopPropagation()})).on("mouseenter",(()=>{e.dragTarget||e.dragSelectStart||t.attr(FSG_HOVER_ATTR,!0)})).on("mouseleave",(()=>{t.attr(FSG_HOVER_ATTR,null)}))}remove(){this.cover?.remove(),super.remove()}forward(){this.cover?.forward(),this.element.forward(),this.cover?.next()?.hasClass("cover")&&(this.cover?.forward(),this.element.forward())}backward(){this.element.prev()?.hasClass("cover")&&(this.element.backward(),this.cover?.backward()),this.element.backward(),this.cover?.backward()}back(){const e=this.draw.findOne("."+CLASS_FSG_UI_SELECT_BOX);this.cover&&e.after(this.cover),e.after(this.element)}front(){this.element.front(),this.cover?.front()}}function currentFillColor(){return SVG("#field_fill").node.value}function currentStrokeColor(){return SVG("#field_stroke").node.value}function useCurrentColors(e){if(window.FSG_BUILDER){const t=currentFillColor(),n=currentStrokeColor();e.attr("fill",t),e.attr("stroke",n)}}function setStrokeColor(e){if(window.FSG_BUILDER){const t=currentStrokeColor();e.attr("stroke",t)}}class AppendingPinPoint{constructor({draw:e,componentRef:t,element:n}){this.element=n,n.component=this,e.dragTarget=n,n.on("dragmove",(()=>{n.fire("update",{target:this})}));const r=componentByNo(e,t);r.element.on("update",this.update.bind(this)),r.element.on("remove",this.remove.bind(this)),this.draw=e,this.targetComponent=r,r.element.hasClass("circle")?this.type="circle":this.type="line",this.update()}remove(){this.targetComponent.element.off("update",this.update),this.targetComponent.element.off("remove",this.remove),this.element.remove(),this.draw.dragTarget=null}done(){const e=this.draw,t=this.type,n={x:this.element.cx(),y:this.element.cy()},r=this.targetComponent.component_no;return this.remove(),this.targetComponent.endAppendMode(),{draw:e,coord:n,type:t,componentRef:r}}update(){if("line"==this.type){const e=this.targetComponent,t=projectPointOnLine(this.draw.mousePosition,e.startPoint(),e.direction());this.element.center(t.x,t.y)}else{const e=this.targetComponent.element,t=this.targetComponent.radius;if(0==t)return;const n={x:e.cx(),y:e.cy()},r={x:this.draw.mousePosition.x-n.x,y:this.draw.mousePosition.y-n.y},o=t/Math.sqrt(r.x**2+r.y**2),s={x:n.x+r.x*o,y:n.y+r.y*o};this.element.center(s.x,s.y)}}}function addAppendingPinPoint({draw:e,componentRef:t}){const n=e.circle(POINT_RADIUS).move(e.mousePosition.x-POINT_RADIUS/2,e.mousePosition.y-POINT_RADIUS/2).attr("class","pin-point").attr(FSG_DRAGGING_ATTR,!0);return new AppendingPinPoint({draw:e,componentRef:t,element:n})}function coverForLineElement(e,t){if(window.FSG_BUILDER){const n={x:t.attr("x1"),y:t.attr("y1")},r={x:t.attr("x2"),y:t.attr("y2")};return e.line(n.x,n.y,r.x,r.y).attr("class","cover")}return null}class LineShape extends Shape{constructor({draw:e,element:t,cover:n,points:r}){super({draw:e,element:t,cover:n,points:r}),this.isAppending=null}startPoint(){const e=this.points[0];let t={x:e.cx(),y:e.cy()};return e.component&&(t=pointOnScreen(e.component)),t}updateDirection(){const[e,t]=this.points,n=pointOnScreen(e.component),r=pointOnScreen(t.component),o=r.x-n.x,s=r.y-n.y,i=Math.sqrt(o**2+s**2);0!==i&&(this._direction={x:o/i,y:s/i})}direction(){return this._direction||this.updateDirection(),this._direction}endAppendMode(){this.isAppending&&(this.isAppending.remove(),this.isAppending=null)}toggleAppendMode(e){if(this.isAppending)this.endAppendMode();else{const t=this.component_no;this.isAppending=addAppendingPinPoint({draw:e,componentRef:t})}}getAttributes(){return["id","class","cx","cy","text","stroke"]}}class Line extends LineShape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const[o,s]=t;this.watchUpdate(t,(()=>{const t=e.bbox(),i=pointOnScreen(o.component),a=pointOnScreen(s.component),[c,l]=clipping(t,i,a);c&&l&&(n.plot(c.x,c.y,l.x,l.y),r?.plot(c.x,c.y,l.x,l.y),this.updateDirection(),n.fire("update"))}))}}function addLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element));if(!n){const t=e.bbox(),[o,i]=s,a={x:o.cx(),y:o.cy()},c={x:i.cx(),y:i.cy()},[l,d]=clipping(t,a,c);setStrokeColor(n=e.line(l.x,l.y,d.x,d.y).attr("class","line dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(l.x,l.y,d.x,d.y).attr("class","cover")}return r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new Line({draw:e,points:s,element:n,cover:r,component_no:o})}function getClipped(e,t,n){const r=e.bbox(),[o,s]=clipping(r,{x:t.x,y:t.y},{x:n.x,y:n.y});if(!o||!s)return;const i=n.x-t.x,a=n.y-t.y,c=o.x-t.x,l=o.y-t.y;let d=o;return 0!=i?c*i<0&&(d=s):l*a<0&&(d=s),d}class Ray extends LineShape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const[o,s]=t;this.watchUpdate(t,(()=>{const t=pointOnScreen(o.component),i=pointOnScreen(s.component),a=getClipped(e,t,i);a&&(n.plot(t.x,t.y,a.x,a.y),r?.plot(t.x,t.y,a.x,a.y),this.updateDirection(),n.fire("update"))}))}}function addRay({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o]=s,i={x:t.cx(),y:t.cy()},a={x:o.cx(),y:o.cy()},c=getClipped(e,i,a);setStrokeColor(n=e.line(i.x,i.y,c.x,c.y).attr("class","ray dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(i.x,i.y,c.x,c.y).attr("class","cover")}return r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new Ray({draw:e,points:s,element:n,cover:r})}function clippedParallelLine(e,t,n){const r=n.component.center(),o=t.component.direction(),s=n,i={x:r.x+20*o.x,y:r.y+20*o.y};return clipping(e.bbox(),{x:s.cx(),y:s.cy()},{x:i.x,y:i.y})}class ParallelLine extends LineShape{constructor({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o]=s,[i,a]=clippedParallelLine(e,t,o);setStrokeColor(n=e.line(i.x,i.y,a.x,a.y).attr("class","parallel-line dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(i.x,i.y,a.x,a.y).attr("class","cover")}r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),super({draw:e,element:n,cover:r,points:s}),n.attr(COMPONENT_REFS_ATTR,t.join(",")),this.watchUpdate(s,(()=>{const[t,o]=s,[i,a]=clippedParallelLine(e,t,o);i&&a&&(n.plot(i.x,i.y,a.x,a.y),r?.plot(i.x,i.y,a.x,a.y),n.fire("update"))})),s.forEach((e=>{e.on("remove",this.remove.bind(this))}))}startPoint(){const e=this.points[1];let t={x:e.cx(),y:e.cy()};return e.component&&(t=pointOnScreen(e.component)),t}direction(){return this.points[0].component.direction()}}function addParallelLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){return new ParallelLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o})}function clippedPerpLine(e,t,n){const r=pointOnScreen({element:n}),o=t.component.direction(),s=pointOnScreen({element:n}),i={x:r.x,y:r.y},a={x:s.x-20*o.y,y:s.y+20*o.x};return clipping(e.bbox(),i,a)}class PerpLine extends LineShape{constructor({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o]=s,[i,a]=clippedPerpLine(e,t,o);setStrokeColor(n=e.line(i.x,i.y,a.x,a.y).attr("class","perp-line dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(i.x,i.y,a.x,a.y).attr("class","cover")}r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),super({draw:e,element:n,cover:r,points:s}),n.attr(COMPONENT_REFS_ATTR,t.join(",")),this.watchUpdate(s,(()=>{const[t,o]=s,[i,a]=clippedPerpLine(e,t,o);i&&a&&(n.plot(i.x,i.y,a.x,a.y),r?.plot(i.x,i.y,a.x,a.y),n.fire("update"))})),s.forEach((e=>{e.on("remove",this.remove.bind(this))}))}startPoint(){const e=this.points[1];let t={x:e.cx(),y:e.cy()};return e.component&&(t=pointOnScreen(e.component)),t}direction(){const e=this.points[0].component.direction();return{x:-e.y,y:e.x}}}function addPerpLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){return new PerpLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o})}class BisectorLine extends LineShape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const[o,s,i]=t;this.watchUpdate(t,(()=>{const t=e.bbox(),a=coordOfBisectorPoint(o,s,i),c={x:s.cx(),y:s.cy()},l={x:a.x,y:a.y},[d,m]=clipping(t,c,l);d&&m&&(n.plot(d.x,d.y,m.x,m.y),r?.plot(d.x,d.y,m.x,m.y),n.fire("update"))}));const a=t.map((e=>(e.on("remove",this.remove.bind(this)),e.attr(COMPONENT_NO_ATTR))));n.attr(COMPONENT_REFS_ATTR,a.join(","))}startPoint(){const e=this.points[1];let t={x:e.cx(),y:e.cy()};return e.component&&(t=pointOnScreen(e.component)),t}direction(){const[e,t,n]=this.points,r=coordOfBisectorPoint(e,t,n),o=this.startPoint(),s=r.x-o.x,i=r.y-o.y,a=Math.sqrt(s**2+i**2);return{x:s/a,y:i/a}}}function coordOfBisectorPoint(e,t,n){const r=e.cx()-t.cx(),o=e.cy()-t.cy(),s=n.cx()-t.cx(),i=n.cy()-t.cy(),a=Math.sqrt(r**2+o**2),c=Math.sqrt(s**2+i**2),l=r/a,d=o/a,m=s/c,p=i/c;return{x:t.cx()+(l+m)/2,y:t.cy()+(d+p)/2}}function addBisectorLine({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o,i]=s,a=e.bbox(),c=coordOfBisectorPoint(t,o,i),l={x:o.cx(),y:o.cy()},d={x:c.x,y:c.y},[m,p]=clipping(a,l,d);setStrokeColor(n=e.line(m.x,m.y,p.x,p.y).attr("class","bisector-line dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(m.x,m.y,p.x,p.y).attr("class","cover")}return r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new BisectorLine({draw:e,points:s,element:n,cover:r})}class SelectablePoint extends SelectableComponent{constructor({draw:e,element:t,override:n}){n||t.on("mousedown",(e=>{t.lastEvent="mousedown",e.stopPropagation()})).on("mouseup",(()=>{"mousedown"==t.lastEvent&&this.toggleSelected(),t.lastEvent="mouseup"})),super({draw:e,element:t})}getAttributes(){return["id","class","cx","cy","text"]}}class IntersectPoint extends SelectablePoint{constructor({draw:e,index:t,componentRefs:n,element:r}){super({draw:e,element:r}),this.index=t,r.attr(COMPONENT_REFS_ATTR,n.join(","));const o=n.map((t=>componentByNo(e,t)));this.refComponents=o,o.forEach((e=>{e.element.on("update",this.update.bind(this)),e.element.on("remove",this.remove.bind(this))}))}remove(){this.refComponents.forEach((e=>{e.element.off("update",this.update)})),super.remove()}update(){const e=this.refComponents;if(e[1]instanceof SelectablePoint){const[t,n]=e,r=projectPointOnLine(pointOnScreen(n),t.startPoint(),t.direction());return this.element.center(r.x,r.y),void this.element.fire("update")}if(e[0]instanceof LineShape)if(e[1]instanceof LineShape){const[t,n]=e,r=intersect(t.startPoint(),t.direction(),n.startPoint(),n.direction());if(!r)return;this.element.center(r.x,r.y)}else{const[t,n]=e,r=intersectLineAndCircle(t.startPoint(),t.direction(),n.center(),n.radius);if(!r)return;const o=r[this.index];o&&this.element.center(o.x,o.y)}else if(e[1]instanceof LineShape){const[t,n]=e,r=intersectLineAndCircle(n.startPoint(),n.direction(),t.center(),t.radius);if(!r)return;const o=r[this.index];this.element.center(o.x,o.y)}else{const[t,n]=e,r=twoCirclesIntersection({a:t.center().x,b:t.center().y,r:t.radius},{a:n.center().x,b:n.center().y,r:n.radius});if(!r)return;const o=r[this.index];this.element.center(o.x,o.y)}this.element.fire("update")}}function addIntersectPoint({draw:e,coord:t,index:n,componentRefs:r,element:o,component_no:s}){return t||(t={x:0,y:0}),o?n=o.attr("index"):o=e.circle(POINT_RADIUS).move(t.x-POINT_RADIUS/2,t.y-POINT_RADIUS/2).attr("class","intersect-point").attr("index",n),s&&o.attr(COMPONENT_NO_ATTR,s),new IntersectPoint({draw:e,index:n,componentRefs:r,element:o})}class MidPoint extends SelectablePoint{constructor({draw:e,componentRefs:t,element:n}){super({draw:e,element:n}),n.attr(COMPONENT_REFS_ATTR,t.join(","));const r=t.map((t=>componentByNo(e,t)));this.refComponents=r,r.forEach((e=>{e.element.on("update",this.update.bind(this)),e.element.on("remove",this.remove.bind(this))}))}remove(){this.refComponents.forEach((e=>{e.element.off("update",this.update)})),super.remove()}update(){const e=this.refComponents,[t,n]=e,r=t.center(),o=n.center(),s={x:(r.x+o.x)/2,y:(r.y+o.y)/2};this.element.center(s.x,s.y),this.element.fire("update")}}function addMidPoint({draw:e,componentRefs:t,element:n,component_no:r}){const o=t.map((t=>componentByNo(e,t).element));if(!n){const[t,r]=o,s={x:t.cx(),y:t.cy()},i={x:r.cx(),y:r.cy()},a={x:(s.x+i.x)/2,y:(s.y+i.y)/2};n=e.circle(POINT_RADIUS).move(a.x-POINT_RADIUS/2,a.y-POINT_RADIUS/2).attr("class","mid-point")}return r&&n.attr(COMPONENT_NO_ATTR,r),new MidPoint({draw:e,componentRefs:t,element:n})}function init_module_history(e){e.fsg.history={},e.fsg.history.history=[],e.fsg.history.redo_list=[]}function doAction(e,t,n){const r=e.fsg.history,o=t(n);o.redo=()=>{o.component_no&&(n.component_no=o.component_no),doAction(e,t,n)},r.history.push(o)}class ChangeLocationAction{constructor(e,t,n){e.forEach((e=>{e.setAttribute("cx",n.x),e.setAttribute("cy",n.y),e.element.fire("update")})),this.components=e,this.oldValue=t,this.newValue=n}undo(){this.components.forEach((e=>{e.setAttribute("cx",this.oldValue.x),e.setAttribute("cy",this.oldValue.y),e.element.fire("update")}))}}function changeLocation({components:e,oldValue:t,newValue:n}){return new ChangeLocationAction(e,t,n)}function setStyle(e){const t=currentStrokeColor();e.attr("stroke",t)}class DraggablePoint extends SelectablePoint{constructor({draw:e,element:t,override:n}){n||(t.on("mousedown",(n=>{t.lastEvent="mousedown",e.dragPointStart=e.point(n.clientX,n.clientY),t.fire("dragstart",{dragTarget:t}),n.stopPropagation()})).on("mouseup",(()=>{"mousedown"==t.lastEvent&&this.toggleSelected(),t.lastEvent="mouseup",t.fire("dragend")})).on("mousemove",(()=>{t.lastEvent="mousemove"})).on("dragstart",(()=>{t.attr(FSG_DRAGGING_ATTR,!0),e.dragTarget=t})).on("dragend",(()=>{const n=[t.component],r={x:e.dragPointStart.x,y:e.dragPointStart.y},o={x:t.cx(),y:t.cy()};doAction(e,changeLocation,{components:n,oldValue:r,newValue:o}),t.attr(FSG_DRAGGING_ATTR,null),e.dragTarget=null})).on("dragmove",(()=>{t.fire("update",{target:this})})),n=!0),super({draw:e,element:t,override:n})}}class Point extends DraggablePoint{constructor({draw:e,element:t}){super({draw:e,element:t})}}function addPoint({draw:e,coord:t,element:n,component_no:r}){return t||(t={x:0,y:0}),n||setStyle(n=e.circle(POINT_RADIUS).move(t.x-POINT_RADIUS/2,t.y-POINT_RADIUS/2).attr("class","point")),r&&n.attr(COMPONENT_NO_ATTR,r),new Point({draw:e,element:n})}class PinPoint extends DraggablePoint{constructor({draw:e,type:t,componentRef:n,element:r}){super({draw:e,element:r,override:!0}),this.type=t,r.attr(COMPONENT_REFS_ATTR,n),r.on("mousedown",(t=>{r.lastEvent="mousedown",e.dragPointStart=e.point(t.clientX,t.clientY),r.fire("dragstart",{dragTarget:r}),t.stopPropagation()})).on("mouseup",(()=>{"mousedown"==r.lastEvent&&this.toggleSelected(),r.lastEvent="mouseup",r.fire("dragend")})).on("mousemove",(()=>{r.lastEvent="mousemove"})).on("dragstart",(()=>{r.attr(FSG_DRAGGING_ATTR,!0),e.dragTarget=r})).on("dragend",(()=>{const t=[r.component],n={x:e.dragPointStart.x,y:e.dragPointStart.y},o={x:r.cx(),y:r.cy()};doAction(e,changeLocation,{components:t,oldValue:n,newValue:o}),r.attr(FSG_DRAGGING_ATTR,null),this.calcState(),e.dragTarget=null})).on("dragmove",(()=>{r.fire("update",{target:this})}));const o=componentByNo(e,n);o.element.on("update",this.update.bind(this)),o.element.on("remove",this.remove.bind(this)),this.targetComponent=o,this.calcState()}remove(){this.targetComponent.element.off("update",this.update),super.remove()}calcState(){const e=this.element;if("line"==this.type){const t=this.targetComponent,n=t.startPoint(),r=t.direction(),o=e.cx()-n.x,s=e.cy()-n.y;this.distance=0!=o?o/r.x:0!=s?s/r.y:0}else{const t=this.targetComponent,n=t.radius;if(0==n)this.unitVector={x:0,y:0};else{const r={x:t.element.cx(),y:t.element.cy()},o={x:e.cx(),y:e.cy()};this.unitVector={x:(o.x-r.x)/n,y:(o.y-r.y)/n}}}}update(){if(this.draw.dragTarget!=this.element){if("line"==this.type){const e=this.targetComponent,t=e.startPoint(),n=e.direction(),r={x:t.x+n.x*this.distance,y:t.y+n.y*this.distance};this.element.center(r.x,r.y)}else{const e=this.targetComponent,t=e.element,n=e.radius;if(0==n)return;const r={x:t.cx(),y:t.cy()},o=this.unitVector,s={x:r.x+o.x*n,y:r.y+o.y*n};this.element.center(s.x,s.y)}this.element.fire("update")}else{if("line"==this.type){const e=this.targetComponent,t=projectPointOnLine(this.draw.mousePosition,e.startPoint(),e.direction());this.element.center(t.x,t.y)}else{const e=this.targetComponent.element,t=this.targetComponent.radius;if(0==t)return;const n={x:e.cx(),y:e.cy()},r={x:this.draw.mousePosition.x-n.x,y:this.draw.mousePosition.y-n.y},o=t/Math.sqrt(r.x**2+r.y**2),s={x:n.x+r.x*o,y:n.y+r.y*o};this.element.center(s.x,s.y)}this.element.fire("update")}}}function addPinPoint({draw:e,coord:t,type:n,componentRef:r,element:o,component_no:s}){return o||(o=e.circle(POINT_RADIUS).move(t.x-POINT_RADIUS/2,t.y-POINT_RADIUS/2).attr("class","pin-point")),s&&o.attr(COMPONENT_NO_ATTR,s),new PinPoint({draw:e,type:n,componentRef:r,element:o})}class InvisiblePoint extends Component{constructor({draw:e,element:t}){super({draw:e,element:t})}select(){}unselect(){}getAttributes(){return[]}}function useCurrentColors$1(e){if(window.FSG_BUILDER){const t=currentStrokeColor();e.attr("style",`color: ${t};`)}}class LaTeX extends SelectableComponent{constructor({draw:e,element:t,componentRef:n}){super({draw:e,element:t}),t.removeClass("text"),t.addClass("latex"),n&&this.watchTarget(e,n),this.makeDraggable(e,t)}watchTarget(e,t){const n=componentByNo(e,t)?.element;n&&(this.target=n,this.watchUpdate([this.target],(()=>{const e=this.element.attr("offset_x"),t=this.element.attr("offset_y"),r={x:n.cx()+e,y:-n.cy()+t};this.element.move(r.x,r.y),this.element.fire("update")})))}makeDraggable(e,t){const n=this.target;t.on("mousedown",(e=>{t.lastEvent="mousedown",t.fire("dragstart",{dragTarget:t}),e.stopPropagation()})).on("mouseup",(()=>{"mousedown"==t.lastEvent&&this.toggleSelected(),t.lastEvent="mouseup",t.fire("dragend")})).on("mousemove",(()=>{t.lastEvent="mousemove"})).on("dragstart",(()=>{t.attr(FSG_DRAGGING_ATTR,!0),e.dragTarget=t})).on("dragend",(()=>{if(t.attr(FSG_DRAGGING_ATTR,null),e.dragTarget=null,n){const e={dx:t.x()-n.cx(),dy:t.y()+n.cy()};t.attr("offset_x",e.dx).attr("offset_y",e.dy)}})).on("dragmove",(()=>{t.fire("update",{target:this})}))}setText(e){e||(e="");let t=this.element;const n=this.draw,r={x:t.attr("x"),y:-t.attr("y")},o={x:t.attr("offset_x")??0,y:t.attr("offset_y")??0},s=t.attr(OF_ATTR),i=this.getAttribute("stroke");t.clear().remove();const a=genLaTeX(this.draw,e,r);a&&(a.attr("offset_x",o.x).attr("offset_y",o.y).attr(COMPONENT_NO_ATTR,this.component_no),s&&a.attr(OF_ATTR,s),a.component=this,this.element=a,s&&this.watchTarget(n,s),this.makeDraggable(n,a),this.setAttribute("stroke",i),n.add(a))}getText(){return this.element.attr("text")}getAttributes(){return["id","class","cx","cy","text","stroke"]}getAttribute(e){if("stroke"==e){return this.element.node.getAttribute("style")?.replace(/(color| |:|;)/g,"")??"#999999ff"}return super.getAttribute(e)}setAttribute(e,t){"stroke"!=e?super.setAttribute(e,t):this.element.attr("style",`color: ${t};`)}}function foreignTex(e,t){const n=SVG(String.raw`<div xmlns="http://www.w3.org/1999/xhtml" class="latex-container"></div>`);let r;try{let o=katex.renderToString(t,katex_options);o=o.replace(/\&nbsp;/g,"&#160;"),n.node.innerHTML=o,r=e.foreignObject(800,600).add(n);const{width:s,height:i}=n.node.getBoundingClientRect();return r.size(s,i),r}catch(e){return r&&r.remove(),null}}function genLaTeX(e,t,n){const r=foreignTex(e,t).flip("y");return r?(r.attr("class","latex").attr("text",t).attr("x",n.x).attr("y",-n.y).attr("style","color: #888"),r):null}function addLaTeX({draw:e,element:t,text:n,unselect:r,componentRef:o}){if(t)o=t.attr(OF_ATTR);else if(o){let r=componentByNo(e,o).center();(t=genLaTeX(e,n=n??DEFAULT_TEXT,r)).attr("offset_x",0).attr("offset_y",0).attr(OF_ATTR,o),useCurrentColors$1(t)}else{const r=e.mousePosition;useCurrentColors$1(t=genLaTeX(e,n=n??DEFAULT_TEXT,r))}const s=new LaTeX({draw:e,element:t,componentRef:o});return r&&unselectComponent(e,s),s}const katex_options={throwOnError:!1,output:"html",delimiters:[{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\begin{equation}",right:"\\end{equation}",display:!0}],trust:!0,strict:"ignore",macros:{"\\eqref":"\\href{#1}{}","\\label":"\\href{#1}{}","\\require":"\\href{#1}{}","\\tag":"\\href{#1}{}","\\hfil":"\\space","\\style":"\\href{#1}{}","\\def":"\\gdef","\\cal":"\\mathcal","\\pmatrix":"\\begin{pmatrix}#1\\end{pmatrix}","\\vmatrix":"\\begin{vmatrix}#1\\end{vmatrix}","\\bmatrix":"\\begin{bmatrix}#1\\end{bmatrix}","\\cases":"\\begin{cases}#1\\end{cases}","\\align":"\\begin{aligned}#1\\end{aligned}","\\eqalign":"\\begin{aligned}#1\\end{aligned}","\\array":"\\begin{array}#1\\end{array}","\\gather":"\\begin{gathered}#1\\end{gathered}"}};function contain_user_script(e){const t=e.defs().find("script");let n=!1;return t.forEach((e=>{e.node.getAttribute("xmlns")==FSG_NAMESPACE&&e.node.textContent.length>0&&(n=!0)})),n}function execute_user_script(draw){const scripts=draw.parent().defs().find("script");scripts.forEach((script=>{if(script.node.getAttribute("xmlns")==FSG_NAMESPACE)try{eval(script.node.textContent)}catch(e){alert(e.stack)}}))}const _serverURL="https://fathomless-brushlands-18222.herokuapp.com";function fetchURL(e,t){return new Promise(((n,r)=>{fetch(e,t).then((e=>e.json())).then((e=>{e.error?r(e.error):n(e)})).catch((e=>{r(e)}))}))}function stdGetHeader$1(){return{method:"GET",headers:new Headers({"Content-Type":"text/plain"})}}function getHash(){return fetchURL(_serverURL+"/code/hash",stdGetHeader$1())}function postCode(e,t){return fetchURL(_serverURL+"/code/"+e,{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})})}class LineSegment extends LineShape{constructor({draw:e,points:t,element:n,cover:r}){if(super({draw:e,element:n,cover:r,points:t}),t){const[e,o]=t;this.watchUpdate(t,(()=>{const t=pointOnScreen(e.component),s=pointOnScreen(o.component);n.plot(t.x,t.y,s.x,s.y),r?.plot(t.x,t.y,s.x,s.y),this.updateDirection(),n.fire("update")}))}else unselectComponent(e,this)}}function addEdge({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o]=s,i={x:t.cx(),y:t.cy()},a={x:o.cx(),y:o.cy()};setStrokeColor(n=e.line(i.x,i.y,a.x,a.y).attr("class","edge dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(i.x,i.y,a.x,a.y).attr("class","cover")}return r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new LineSegment({draw:e,points:s,element:n,cover:r})}function addVector({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,o]=s,i={x:t.cx(),y:t.cy()},a={x:o.cx(),y:o.cy()};setStrokeColor(n=e.line(i.x,i.y,a.x,a.y).attr("class","vector dashed").attr(FSG_SHAPE_ATTR,!0)),r=e.line(i.x,i.y,a.x,a.y).attr("class","cover")}return r=r??coverForLineElement(e,n),putBehindPoints(e,s,r,n),n.marker("start",e.fsg.marker.vector_start_marker),n.marker("end",e.fsg.marker.vector_end_marker),o&&n.attr(COMPONENT_NO_ATTR,o),new LineSegment({draw:e,points:s,element:n,cover:r})}class Axis extends LineSegment{constructor({draw:e,element:t,cover:n,type:r}){super({draw:e,element:t,cover:n}),this._direction="axis-x"==r?{x:1,y:0}:{x:0,y:1}}startPoint(){return{x:this.element.attr("x1"),y:this.element.attr("y1")}}setCoord(e,t){this.element.plot(e.x,e.y,t.x,t.y),this.cover?.plot(e.x,e.y,t.x,t.y),this.element.fire("update")}}function addAxis({draw:e,type:t,element:n,cover:r,component_no:o}){if(!n){const o=e.parent().viewbox();let s,i;"axis-x"==t?(s={x:-o.width/2,y:0},i={x:o.width/2,y:0}):(s={x:0,y:-o.height/2},i={x:0,y:o.height/2}),n=e.line(s.x,s.y,i.x,i.y).attr("class",t+" dashed").attr("stroke",DEFAULT_STROKE_COLOR).attr(FSG_SHAPE_ATTR,!0),r=e.line(s.x,s.y,i.x,i.y).attr("class","cover")}return r=r??coverForLineElement(e,n),n.marker("end",e.fsg.marker.vector_end_marker),n.removeClass("dashed"),n.addClass(t),o&&n.attr(COMPONENT_NO_ATTR,o),new Axis({draw:e,element:n,cover:r,type:t})}function coverForCircleElement(e,t){if(window.FSG_BUILDER){const n=t.attr("r"),r=t.attr("cx"),o=t.attr("cy");return e.circle().radius(n).center(r,o).attr("class","cover")}return null}class FillableShape extends Shape{constructor({draw:e,element:t,cover:n,points:r}){super({draw:e,element:t,cover:n,points:r})}}class Circle extends FillableShape{constructor({draw:e,radius:t,points:n,element:r,cover:o}){super({draw:e,element:r,cover:o,points:n}),this.radius=t;const[s,i]=n;this.watchUpdate(n,(()=>{const e=pointOnScreen({element:s}),t=pointOnScreen({element:i}),n=Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2);this.radius=n,r.radius(n).center(s.cx(),s.cy()),o?.radius(n).center(s.cx(),s.cy()),r.fire("update")}))}endAppendMode(){this.isAppending&&(this.isAppending.remove(),this.isAppending=null)}toggleAppendMode(e){if(this.isAppending)this.endAppendMode();else{const t=this.component_no;this.isAppending=addAppendingPinPoint({draw:e,componentRef:t})}}}function addCircle({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element)),[i,a]=s,c=Math.sqrt((a.cx()-i.cx())**2+(a.cy()-i.cy())**2);return n||(useCurrentColors(n=e.circle().radius(c).center(i.cx(),i.cy()).attr("class","circle dashed").attr(FSG_FILL_NONE_ATTR,!0).attr(FSG_SHAPE_ATTR,!0)),r=e.circle().radius(c).center(i.cx(),i.cy()).attr("class","cover")),r=r??coverForCircleElement(e,n),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new Circle({draw:e,radius:c,points:s,element:n,cover:r,component_no:o})}class Polygon extends FillableShape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t}),this.watchUpdate(t,(()=>{let e=t.map((e=>{const t=pointOnScreen(e.component);return[t.x,t.y]}));n.plot(e),r?.plot(e),n.fire("update")}))}}function addPolygon({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){const s=t.map((t=>componentByNo(e,t).element)),i=s.map((e=>[e.cx(),e.cy()]));return n||useCurrentColors(n=e.polygon(i).attr("class","polygon dashed").attr(FSG_FILL_NONE_ATTR,!0).attr(FSG_SHAPE_ATTR,!0)),window.FSG_BUILDER&&(r=e.polygon(i).attr("class","cover")),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new Polygon({draw:e,points:s,element:n,cover:r})}function arcPathOf(e,t,n,r=!1){const o=DEFAULT_ANGLE_RADIUS;t={x:t.cx(),y:t.cy()};const s=e.cx()-t.x,i=e.cy()-t.y,a=n.cx()-t.x,c=n.cy()-t.y,l=Math.sqrt(s**2+i**2),d=Math.sqrt(a**2+c**2);if(0==l||0==d)return"";let m=s/l*o,p=i/l*o,u=a/d*o,h=c/d*o;const _=t.x+m,f=t.y+p,x=t.x+u,y=t.y+h;let T=m*h-p*u>=0?0:1,g=1;const E=1e-6;if(r){if(Math.abs(u+p)<E&&Math.abs(h-m)<E)return String.raw`M ${t.x} ${t.y} L ${_} ${f} L ${_+u} ${f+h} L ${x} ${y} Z`}else if(g=1==T?0:1,T=0,Math.abs(u+p)<E&&Math.abs(h-m)<E||Math.abs(m+h)<E&&Math.abs(p-u)<E)return String.raw`M ${t.x} ${t.y} L ${_} ${f} L ${_+u} ${f+h} L ${x} ${y} Z`;return String.raw`M ${_} ${f} A ${o} ${o} 0 ${T} ${g} ${x} ${y} L ${t.x} ${t.y} Z`}class Arc extends FillableShape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const o=n.attr("large_arc");this.large_arc=void 0!==o&&"true"==o;const[s,i,a]=t;this.watchUpdate(t,(()=>{const e=arcPathOf(s,i,a,this.large_arc);n.plot(e),r?.plot(e),n.fire("update")}));const c=t.map((e=>(e.on("remove",this.remove.bind(this)),e.attr("component_no"))));n.attr(COMPONENT_REFS_ATTR,c.join(","))}toggleMode(){this.large_arc=!this.large_arc,this.element.attr("large_arc",this.large_arc?"true":"false"),this.points[0].fire("update")}}function addAngle({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,r,o]=s,i=arcPathOf(t,r,o,!1);useCurrentColors(n=e.path(i).attr("class","angle").attr(FSG_FILL_NONE_ATTR,!0).attr(FSG_SHAPE_ATTR,!0))}return window.FSG_BUILDER&&(r=e.path(n.array()).attr("class","cover")),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new Arc({draw:e,points:s,element:n,cover:r})}function arrowedArcPathOf(e,t,n,r=!1){const o=3*DEFAULT_ANGLE_RADIUS;t={x:t.cx(),y:t.cy()};const s=e.cx()-t.x,i=e.cy()-t.y,a=n.cx()-t.x,c=n.cy()-t.y,l=Math.sqrt(s**2+i**2),d=Math.sqrt(a**2+c**2);if(0==l||0==d)return"";let m=s/l*o,p=i/l*o,u=a/d*o,h=c/d*o;const _=t.x+m,f=t.y+p,x=t.x+u,y=t.y+h;let T=m*h-p*u>=0?0:1,g=1;return r||(g=1==T?0:1,T=0),String.raw`M ${_} ${f} A ${o} ${o} 0 ${T} ${g} ${x} ${y}`}class ArrowedArc extends Shape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const o=n.attr("large_arc");this.large_arc=void 0!==o&&"true"==o;const[s,i,a]=t;this.watchUpdate(t,(()=>{const e=arrowedArcPathOf(s,i,a,this.large_arc);n.plot(e),r?.plot(e),n.fire("update")}));const c=t.map((e=>(e.on("remove",this.remove.bind(this)),e.attr("component_no"))));n.attr(COMPONENT_REFS_ATTR,c.join(","))}center(){const[e,t,n]=this.points,r=4*DEFAULT_ANGLE_RADIUS;let o={x:e.cx()-t.cx(),y:e.cy()-t.cy()};const s=Math.sqrt(o.x**2+o.y**2);o={x:o.x/s*r,y:o.y/s*r};let i={x:n.cx()-t.cx(),y:n.cy()-t.cy()};const a=Math.sqrt(i.x**2+i.y**2);i={x:i.x/a*r,y:i.y/a*r};const c=i.y-o.y,l=-(i.x-o.x),d=Math.sqrt(c**2+l**2);if(0==d)return{x:t.cx()+o.x-DEFAULT_LABEL_OFFSET_X-4,y:t.cy()+o.y+DEFAULT_LABEL_OFFSET_Y+8};const m=o.x*i.y-o.y*i.x,p=r/d;return!this.large_arc&&m<0?{x:t.cx()-c*p-DEFAULT_LABEL_OFFSET_X-4,y:t.cy()-l*p+DEFAULT_LABEL_OFFSET_Y+8}:{x:t.cx()+c*p-DEFAULT_LABEL_OFFSET_X-4,y:t.cy()+l*p+DEFAULT_LABEL_OFFSET_Y+8}}toggleMode(){this.large_arc=!this.large_arc,this.element.attr("large_arc",this.large_arc?"true":"false"),this.points[0].fire("update")}}function addAngleMarker({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,r,o]=s,i=arrowedArcPathOf(t,r,o,!1);useCurrentColors(n=e.path(i).attr("class","angle-marker").attr(FSG_FILL_NONE_ATTR,!0).attr(FSG_SHAPE_ATTR,!0))}return window.FSG_BUILDER&&(r=e.path(n.array()).attr("class","cover")),n.marker("end",e.fsg.marker.vector_end_marker),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new ArrowedArc({draw:e,points:s,element:n,cover:r})}function normalVec(e,t){const n=t.cx()-e.cx(),r=t.cy()-e.cy(),o=Math.sqrt(n**2+r**2);return 0==o?{x:0,y:0}:{x:-r/o,y:n/o}}function stretchVec(e,t){return{x:e.x*t,y:e.y*t}}function lengthPathOf(e,t,n){const r=normalVec(e,t);if(0==r.x&&0==r.y)return"";const o=DEFAULT_LENGTH_MARKER_WIDTH,s=stretchVec(r,n),i=stretchVec(r,o);e={x:e.cx()+s.x,y:e.cy()+s.y},t={x:t.cx()+s.x,y:t.cy()+s.y};const a=e.x+i.x,c=e.y+i.y,l=e.x-i.x,d=e.y-i.y,m=t.x+i.x,p=t.y+i.y,u=t.x-i.x,h=t.y-i.y;return String.raw`M ${a} ${c} L ${l} ${d}
  M ${m} ${p} L ${u} ${h}
  M ${e.x} ${e.y} L ${t.x} ${t.y}`}class LengthMarker extends Shape{constructor({draw:e,points:t,element:n,cover:r}){super({draw:e,element:n,cover:r,points:t});const[o,s]=t;this.watchUpdate(t,(()=>{const e=this.mark_on_right?-DEFAULT_LENGTH_MARKER_DISTANCE:DEFAULT_LENGTH_MARKER_DISTANCE,t=lengthPathOf(o,s,e);n.plot(t),r?.plot(t),n.fire("update")}));const i=t.map((e=>(e.on("remove",this.remove.bind(this)),e.attr("component_no"))));n.attr(COMPONENT_REFS_ATTR,i.join(",")),this.mark_on_right=!1}center(){const e=this.mark_on_right?-(DEFAULT_LENGTH_MARKER_DISTANCE+10):DEFAULT_LENGTH_MARKER_DISTANCE+10,[t,n]=this.points,r=normalVec(t,n);return{x:(t.cx()+n.cx())/2+r.x*e-DEFAULT_LABEL_OFFSET_X-4,y:(t.cy()+n.cy())/2+r.y*e+DEFAULT_LABEL_OFFSET_Y+8}}toggleMode(){this.mark_on_right=!this.mark_on_right,this.element.attr("mark_on_right",this.mark_on_right?"true":"false"),this.points[0].fire("update")}}function addLengthMarker({draw:e,componentRefs:t,element:n,cover:r,component_no:o}){let s=t.map((t=>componentByNo(e,t).element));if(!n){const[t,r]=s,o=lengthPathOf(t,r,DEFAULT_LENGTH_MARKER_DISTANCE);useCurrentColors(n=e.path(o).attr("class","length-marker").attr(FSG_FILL_NONE_ATTR,!0).attr(FSG_SHAPE_ATTR,!0))}return window.FSG_BUILDER&&(r=e.path(n.array()).attr("class","cover")),putBehindPoints(e,s,r,n),o&&n.attr(COMPONENT_NO_ATTR,o),new LengthMarker({draw:e,points:s,element:n,cover:r})}function findAllComponentElements(e){const t=e.find(`[${COMPONENT_NO_ATTR}]`);return t.sort(((e,t)=>Number(e.attr(COMPONENT_NO_ATTR))-Number(t.attr(COMPONENT_NO_ATTR)))),t}function elementByNo(e,t){let n;return e.forEach((e=>{Number(e.attr(COMPONENT_NO_ATTR))==t&&(n=e)})),n}function reconstruct_components(e){const t=findAllComponentElements(e);t.forEach((n=>{if(n.hasClass("point"))return void addPoint({draw:e,element:n});if(n.hasClass("mid-point")){const t=n.attr(COMPONENT_REFS_ATTR);if(!t)return;const r=t.split(",").map((e=>Number(e)));return void addMidPoint({draw:e,componentRefs:r,element:n})}if(n.hasClass("intersect-point")){const t=n.attr(COMPONENT_REFS_ATTR);if(!t)return;const r=t.split(",").map((e=>Number(e)));return void addIntersectPoint({draw:e,componentRefs:r,element:n})}if(n.hasClass("parallel-point"))return;if(n.hasClass("perp-point"))return;if(n.hasClass("pin-point")){const r=n.attr(COMPONENT_REFS_ATTR);if(!r)return;let o="line";return elementByNo(t,r)instanceof SVG.Circle&&(o="circle"),void addPinPoint({draw:e,type:o,componentRef:r,element:n})}if(n.hasClass("latex")||n.hasClass("text"))return void addLaTeX({draw:e,element:n});if(n.hasClass("axis-x")){return void addAxis({draw:e,type:"axis-x",element:n})}if(n.hasClass("axis-y")){return void addAxis({draw:e,type:"axis-y",element:n})}const r=n.attr(COMPONENT_REFS_ATTR);if(!r)return;const o=r.split(",").map((e=>Number(e)));if(n.hasClass("edge"))addEdge({draw:e,componentRefs:o,element:n});else if(n.hasClass("vector"))addVector({draw:e,componentRefs:o,element:n});else if(n.hasClass("line"))addLine({draw:e,componentRefs:o,element:n});else if(n.hasClass("ray"))addRay({draw:e,componentRefs:o,element:n});else if(n.hasClass("polygon"))addPolygon({draw:e,componentRefs:o,element:n});else if(n.hasClass("circle"))addCircle({draw:e,componentRefs:o,element:n});else if(n.hasClass("angle"))addAngle({draw:e,componentRefs:o,element:n});else if(n.hasClass("angle-marker"))addAngleMarker({draw:e,componentRefs:o,element:n});else if(n.hasClass("length-marker"))addLengthMarker({draw:e,componentRefs:o,element:n});else{if(n.hasClass("parallel-line")){let r=o;const[,s]=o,i=elementByNo(t,s);return i.hasClass("parallel-point")&&(r=i.attr(COMPONENT_REFS_ATTR).split(",")),void addParallelLine({draw:e,componentRefs:r,element:n})}if(n.hasClass("perp-line")){let r=o;const[,s]=o,i=elementByNo(t,s);return i.hasClass("perp-point")&&(r=i.attr(COMPONENT_REFS_ATTR).split(",")),void addPerpLine({draw:e,componentRefs:r,element:n})}n.hasClass("bisector-line")&&addBisectorLine({draw:e,componentRefs:o,element:n})}}))}function patchSVGJS(e){e.find(".latex-container").each((e=>{e.find("svg").each((e=>{e.attr("xmlns:svgjs",null),e.attr("xmlns:svgjs","https://svgjs.com/svgjs")}))}))}function cleanupDirtyElements(e){e.find(".hidden-point, .cover, .parallel-point, .perp-point").each((e=>e.remove()));e.find(".selected, .inspecting, .dragging, .hover, .component, .none, .hidden, .shape").each((e=>{e.removeClass("component").removeClass("selected").removeClass("inspecting").removeClass("dragging").removeClass("hover"),e.hasClass("shape")&&e.removeClass("shape").attr(FSG_SHAPE_ATTR,!0),e.hasClass("none")&&e.removeClass("none").attr(FSG_FILL_NONE_ATTR,!0),e.hasClass("hidden")&&e.removeClass("hidden").attr(FSG_HIDDEN_ATTR,!0)}));[`[${FSG_SELECTED_ATTR}]`,`[${FSG_INSPECTING_ATTR}]`,`[${FSG_DRAGGING_ATTR}]`,`[${FSG_HOVER_ATTR}]`].forEach((t=>{e.find(t).forEach((e=>{e.attr(FSG_SELECTED_ATTR,null).attr(FSG_INSPECTING_ATTR,null).attr(FSG_DRAGGING_ATTR,null).attr(FSG_HOVER_ATTR,null)}))}))}function patchStyles(e){const t=e.defs();t.find("style").forEach((e=>e.remove())),t.first().before(SVG(RUNTIME_DEFAULT_STYLE));t.find("link").forEach((e=>e.remove())),t.first().after(SVG(KATEX_STYLE_LINK)),t.first().after(SVG(RUNTIME_STYLE_LINK))}function patchForeignObjectLaTeX(e){e.find("div.latex-container").forEach((e=>{e.attr("xmlns",null).attr("xmlns","http://www.w3.org/1999/xhtml")}))}function patchToNewClass(e){e.findOne(".ui-select-box")?.attr("class",CLASS_FSG_UI_SELECT_BOX)}function svgDocument(e,t={}){let n=e.parent().svg();const r=SVG(n).attr("xmlns:svgjs",null).attr("xmlns:svgjs","https://svgjs.com/svgjs").attr("xmlns:fsg",null).attr("xmlns:fsg",FSG_NAMESPACE).attr("style",null);for(const[e,n]of Object.entries(t))r.attr(e,n);patchSVGJS(r),cleanupDirtyElements(r),patchStyles(r),patchForeignObjectLaTeX(r),patchToNewClass(r);return r.svg().replace(/\&nbsp;/g,"&#160;")}function saveAsSVG(e){var t=document.createElement("a");const n=svgDocument(e);t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),t.setAttribute("download",e.fsg.filename),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function exportToHTML(e){const t=e.fsg.filename.replace(/\.svg/,".html");var n=document.createElement("a");let r=svgDocument(e,{style:"width:100%;"});r="<!DOCTYPE html>"+String.raw`<head>
    <title>Fast SVG Geometry</title>
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
    <link rel="stylesheet" type="text/css" href="${SERVER_ROOT}/style/runtime.css">
    <link rel="icon" href="${SERVER_ROOT}/images/favicon.ico" type="image/x-icon" />
  </head>
`+'<body><div style="overflow:hidden">'+r+"</div></body></html>",n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(r)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}let _visible=!1;function show(e){const t=e.parent();SVG("#field_pref_width").node.value=t.attr("width");SVG("#field_pref_height").node.value=t.attr("height"),SVG("#preferenceWindow").attr("style","visibility: visible;"),_visible=!0}function hide(){SVG("#preferenceWindow").attr("style","visibility: hidden;"),_visible=!1}function toggle_preference_window(e){_visible?hide():show(e)}function showHint(e){const t=SVG("#hintBox").node,n=SVG("#message").node;n.innerText=e??n.innerText,t.classList.remove("fadeInOut"),setTimeout((()=>{t.classList.add("fadeInOut")}),100)}const MENU_WIDTH=130,MENU_PADDING_LEFT=10,MENU_PADDING_TOP=5,MENU_PADDING_BOTTOM=5,MENU_ITEM_HEIGHT=23,MENU_BACKGROUND_COLOR="#202020",MENU_BORDER_COLOR="#666",MENU_SEPARATOR_COLOR_TOP="#555",MENU_SEPARATOR_COLOR_BOTTOM="#121212";class MenuItem{constructor(e,t,n){const r=t.text(n).flip("y").attr("class","menu_item");r.on("mousedown",(t=>{this.onMouseDown(e),t.preventDefault(),t.stopPropagation()})),r.menu=t,this.item=r}move(e,t){this.item.move(e,t)}onMouseDown(){}}class Menu{constructor(e,t,n){this.draw=e;const r=e.group().translate(t.x,t.y).attr("class","menu"),o=r.rect(MENU_WIDTH,50).flip("y").stroke({color:MENU_BORDER_COLOR,width:.3}).fill(MENU_BACKGROUND_COLOR);r.text(n).flip("y").attr("class","menu_title").move(MENU_PADDING_LEFT,MENU_PADDING_TOP),this.numItems=0,this.menu=r,this.background=o,e.menu=this}addMenuItem(e,t){const n=new MenuItem(this.draw,this.menu,e);n.onMouseDown=()=>{this.remove(),t()},this.numItems++;const r=MENU_PADDING_TOP+MENU_ITEM_HEIGHT*this.numItems;this.menu.line(MENU_PADDING_LEFT-5,r,MENU_WIDTH+5-MENU_PADDING_LEFT,r).flip("y").stroke(MENU_SEPARATOR_COLOR_TOP),this.menu.line(MENU_PADDING_LEFT-5,r+1,MENU_WIDTH+5-MENU_PADDING_LEFT,r+1).flip("y").stroke(MENU_SEPARATOR_COLOR_BOTTOM),n.move(MENU_PADDING_LEFT,r+3),this.background.size(MENU_WIDTH,r+MENU_ITEM_HEIGHT+MENU_PADDING_BOTTOM)}remove(){this.menu.remove(),this.draw.menu=null}}class RuntimeMenu extends Menu{constructor(e,t){super(e,t,"Menu"),this.addMenuItem("Edit",(()=>{const t=SVG(e.parent().svg());t.findOne("#FSG_UI_LAYER")?.remove(),t.findOne("#FSG_HOVER_FILTER")?.remove();const n={code:t.svg()};getHash().then((e=>{const t=e.hash;postCode(t,n).then((()=>{window.open(SERVER_ROOT+"?source=pwa&hash="+t,"_blank",`resizable, width=${DEFAULT_WINDOW_WIDTH}, height=${DEFAULT_WINDOW_HEIGHT}`)})).catch((e=>{}))})).catch((e=>{}))})),this.addMenuItem("Play",(()=>execute_user_script(e))),this.addMenuItem("Reload",(()=>location.reload()))}}class BuilderMenu extends Menu{constructor(e,t){super(e,t,"Menu"),this.addMenuItem("Open File",(()=>{const e=SVG("#file");e.node.value="",e.node.click()})),this.addMenuItem("Copy As SVG",(()=>{const t=svgDocument(e);navigator.clipboard.writeText(t).then((()=>{showHint("Copied!")}))})),this.addMenuItem("Save As SVG",(()=>saveAsSVG(e))),this.addMenuItem("Export to HTML",(()=>exportToHTML(e))),this.addMenuItem("Reset Viewbox",(()=>{const t=e.parent().attr("width"),n=e.parent().attr("height");e.parent().viewbox(0,0,t,n)})),this.addMenuItem("Preference",(()=>toggle_preference_window(e)))}}function init_module_drag(e,t=!0){let n;e.on("contextmenu",(e=>e.preventDefault()));const r=e.findOne("."+CLASS_FSG_UI_SELECT_BOX);r?n=r:(n=e.parent().rect(0,0).attr("class",CLASS_FSG_UI_SELECT_BOX),e.add(n)),e.selectBox=n,e.dragTarget=null,e.dragStart=null,e.on("mousedown",(t=>{if(e.menu)e.menu.remove();else{if(2==t.button)return window.FSG_RUNTIME?new RuntimeMenu(e,e.point(t.clientX,t.clientY)):window.FSG_BUILDER&&new BuilderMenu(e,e.point(t.clientX,t.clientY)),t.preventDefault(),void t.stopPropagation();if(0==t.button){if(e.dragTarget&&e.dragTarget.component instanceof AppendingPinPoint){const t=e.dragTarget.component.done();doAction(e,addPinPoint,t)}else e.lastEvent="mousedown";t.altKey||(e.dragStart=e.point(t.clientX,t.clientY)),e.dragTarget=null}}})).on("mouseup_on_document",(()=>{e.dragTarget&&(e.dragTarget.fire("dragend"),e.dragTarget=null),e.dragStart&&(e.dragStart=null,n.size(0,0))})).on("mouseup",(r=>{if(e.dragTarget&&(e.dragTarget.fire("dragend"),e.dragTarget=null),e.dragStart=null,n.size(0,0),"mousedown"==e.lastEvent&&(e.lastEvent="mouseup",t)){let t=e.point(r.clientX,r.clientY);t=snapTo(t),doAction(e,addPoint,{draw:e,coord:t})}})).on("mousemove",(t=>{e.lastEvent="mousemove";const r=e.point(t.clientX,t.clientY);e.mousePosition=snapTo(r);const o=e.dragTarget;if(o)if(o.component instanceof AppendingPinPoint||o.component instanceof PinPoint)o.component.update();else{const e={x:o.cx(),y:o.cy()},t=r;t.x==e.x&&t.y==e.y||("text"==o.type||o.component instanceof LaTeX?o.center(t.x,-t.y):o.center(t.x,t.y),o.fire("dragmove"))}if(e.dragStart){let o=Math.abs(r.x-e.dragStart.x),s=Math.abs(r.y-e.dragStart.y),i=(r.x+e.dragStart.x)/2,a=(r.y+e.dragStart.y)/2;n.size(o,s).center(i,a),selectAllInBox(e,n,t.shiftKey)}}))}function selectAllInBox(e,t,n){e.find(`[${COMPONENT_NO_ATTR}]`).forEach((r=>{if(r.component instanceof InvisiblePoint)return;if(!n&&r.attr(FSG_SELECTED_ATTR))return;const o=r.bbox();t.inside(o.x,o.y)&&t.inside(o.x+o.width,o.y+o.height)&&(n?unselectComponent(e,r.component):selectComponent(e,r.component))}))}function init_module_selection(e){e.fsg.selection={},e.fsg.selection.selections=[],window.selectComponent=selectComponent$1,window.unselectComponent=unselectComponent$1}const inspector=SVG("#inspector");function inspect(e){inspector?.fire("inspect-component",{component:e})}function detach(){inspector?.fire("inspect-detach")}function selectComponent$1(e,t){if(!e.ready)return;let n=e.fsg.selection.selections;return(Array.isArray(t)?t:[t]).forEach((e=>{e instanceof InvisiblePoint||(e.select(),n=n.filter((t=>t!==e)),n.push(e),inspect(e))})),e.fsg.selection.selections=n,t}function unselectComponent$1(e,t){let n=e.fsg.selection.selections;(Array.isArray(t)?t:[t]).forEach((e=>{e.unselect(),n=n.filter((t=>t!==e))}));const r=n.length;return 0==r?detach():inspect(n[r-1]),e.fsg.selection.selections=n,t}function init_modules(e){e.fsg={},init_module_marker(e),init_module_history(e),init_module_selection(e),init_component_system(e),init_module_drag(e,!1),reconstruct_components(e)}function UILayer(e){let t=e.parent().findOne("#FSG_UI_LAYER");return t||(t=e.parent().group().attr("id","FSG_UI_LAYER")),t}function drawTitle(e,t){const n=UILayer(e),r=n.text(t).attr("class","title").attr("offset_x",0).attr("offset_y",0),{width:o,height:s}=n.parent().viewbox(),i={x:(o-r.bbox().width)/2,y:s-30};r.move(i.x,i.y),n.add(r);const a=r.bbox();n.rect(a.width+30,a.height+8).radius(10,15).attr("fill","#000").attr("stroke","#888").center(r.cx(),r.cy()).insertBefore(r)}function showPlayButton(e){let t=e.parent().defs().findOne("#FSG_HOVER_FILTER");t||(t=SVG(String.raw`<filter id="FSG_HOVER_FILTER" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="linearRGB">
  <feBlend mode="screen" x="0%" y="0%" width="100%" height="100%" in="SourceGraphic" in2="SourceGraphic" result="blend1"/>
</filter>`),e.parent().defs().add(t));const n=UILayer(e).image(`${SERVER_ROOT}/images/run.svg`).size(34,34),{width:r}=e.parent().viewbox();n.move(r-44,10).on("click",(()=>{execute_user_script(e)})).on("mouseover",(()=>n.attr("filter","url(#FSG_HOVER_FILTER)"))).on("mouseleave",(()=>n.attr("filter",null)))}function init(){if(window.FSG_BUILDER);else{if(window.FSG_RUNTIME)return;window.FSG_RUNTIME=!0,SVG.extend(SVG.Runner,{update:function(){this.during((()=>this.element().fire("update")))}});if(document.contentType.includes("html")){SVG.find("fsg").forEach((e=>{fetchSrc(e.attr("src")).then((t=>{if(!t)return;const n=SVG(t),r=n.first();r._content=n.svg(),init_modules(r),r.ready=!0,e.add(n);const o=e.attr("title");o&&drawTitle(r,o),contain_user_script(r)&&showPlayButton(r)}))}))}else{const e=SVG("svg"),t=e.first();t._content=e.svg(),init_modules(t),t.ready=!0;const n=window.frameElement?.getAttribute("title");n&&drawTitle(t,n),contain_user_script(t)&&showPlayButton(t)}}}SVG.on(document,"DOMContentLoaded",(()=>init()))})();